}
index.dropped <- NULL
if (sum.caliper.drops > 0) {
if (estimand.orig == "ATT") {
matched.index <- which(Tr == 1)
matched <- !(matched.index %in% index.treated)
}
else if (estimand.orig == "ATC") {
matched.index <- which(Tr == 0)
matched <- !(matched.index %in% index.control)
}
else if (estimand.orig == "ATE") {
matched.index <- 1:length(Tr)
matched <- !(matched.index %in% c(index.treated,
index.control))
}
index.dropped <- matched.index[matched]
}
z <- list(est = ret$est, se = ret$se, est.noadj = mest, se.standard = se.standard,
se.cond = ret$se.cond, mdata = mdata, index.treated = index.treated,
index.control = index.control, index.dropped = index.dropped,
weights = weights, orig.nobs = orig.nobs, orig.wnobs = orig.wnobs,
orig.treated.nobs = orig.treated.nobs, nobs = nobs, wnobs = wnobs,
caliper = caliper, ecaliper = ecaliper, exact = exact,
ndrops = actual.drops, ndrops.matches = sum.caliper.drops,
MatchLoopC = ret$MatchLoopC, version = version, estimand = estimand.orig)
if (MatchbyAI) {
z$YCAUS <- ret$YCAUS
z$ZCAUS <- ret$ZCAUS
z$Kcount <- ret$Kcount
z$KKcount <- ret$KKcount
z$Sigs <- ret$Sigs
}
class(z) <- "Match"
return(z)
}
match.outcome.mah <- Match(Y=runif(length(mex.df$pctpd0306)), Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 2 , distance.tolerance = 1e-12, weights=runif(length(mex.df$pctpd0306)-1))
else {5}
match.outcome.mah <- Match(Y=c(runif(length(mex.df$pctpd0306)-1), NA), Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 2 , distance.tolerance = 1e-12)
match.outcome.mah <- Match(Y=mex.df$pctpd0306), Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 2 , distance.tolerance =  -1 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 2 , distance.tolerance =  -1 )
warning("User set 'tolerance' to less than 0.  Resetting to the default which is 0.00001.")
?warning
options("warn")
testit <- function() warning("testit")
testit() ## shows call
options(warn=0)
testit <- function() warning("testit")
testit() ## shows call
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 2 , distance.tolerance =  -1 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 2 , distance.tolerance =  1e-12 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 5 , distance.tolerance =  1e-12 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 2 , distance.tolerance =  1e-12 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=scale(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]), M=1, replace=FALSE, Weight= 1 , distance.tolerance =  1e-12 )
min(eigen(t(X.mat) %*% X.mat/nrow(X.mat), only.values = TRUE)$values) > 1e-07
sqrt(.Machine$double.eps)
min(eigen(solve(t(X.mat) %*% X.mat/nrow(X.mat)), only.values = TRUE)$values)
min(eigen(solve(t(X.mat) %*% X.mat/nrow(X.mat)), only.values = TRUE)$values) <
sqrt(.Machine$double.eps)
as.double(sum((solve(t(X.mat) %*% X.mat/nrow(X.mat) !=
diag(diag(solve(t(X.mat) %*% X.mat/nrow(X.mat))))) == 0)
as.double(sum((solve(t(X.mat) %*% X.mat/nrow(X.mat)) !=
diag(diag(solve(t(X.mat) %*% X.mat/nrow(X.mat)))))) == 0)
solve(t(X.mat) %*% X.mat/nrow(X.mat))
sum((solve(t(X.mat) %*% X.mat/nrow(X.mat)) !=
diag(diag(solve(t(X.mat) %*% X.mat/nrow(X.mat))))))
as.double(sum((solve(t(X.mat) %*% X.mat/nrow(X.mat)) !=
diag(diag(solve(t(X.mat) %*% X.mat/nrow(X.mat)))))) == 0)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=1, replace=FALSE, Weight= 1 , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=1, replace=FALSE, Weight= 2 , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=1, replace=T, Weight= 2 , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=1, replace=T, Weight= 1 , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=1, replace=T, Weight= 1)
#  , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=2, replace=T, Weight= 1)
#  , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=1, replace=T, Weight= 2)
#  , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], M=1, replace=T, Weight= 1)
#  , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 1)
#  , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 2)
#  , distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 2, distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 1, distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 1, weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 1, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=T, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(runif(10)), distance.tolerance =  1e-12 )
# rep(1, 10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 3, Weight.matrix=diag(rep(1, 10)), distance.tolerance =  1e-12 )
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 1,  distance.tolerance =  1e-12 )
# Weight.matrix=diag(rep(1, 10)),
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 2,  distance.tolerance =  1e-12 )
# Weight.matrix=diag(rep(1, 10)),
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 5,  distance.tolerance =  1e-12 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 1,  distance.tolerance =  1e-12 )
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 1,  distance.tolerance =  1e-12, version="legacy" )
# Weight.matrix=diag(rep(1, 10)),
# rep(1, 10) runif(10)
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 2,  distance.tolerance =  1e-12, version="legacy" )
# Weight.matrix=diag(rep(1, 10)),
# rep(1, 10) runif(10)
summary(match.outcome.mah)
?matchit
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
region.factor + psemidecid + pselva, data=mex.df, method = "nearest", distance = "mahalanobis")
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
region.factor + psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], method = "nearest", distance = "mahalanobis")
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
region.factor + psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "region.factor", "psemidecid", "pselva")], method = "nearest", distance = "mahalanobis")
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
regionNW + regionCN + regionCS + regionS + psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "region.factor", "psemidecid", "pselva")], method = "nearest", distance = "mahalanobis")
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
regionNW + regionCN + regionCS + regionS + psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], method = "nearest", distance = "mahalanobis")
solve(t(as.matrix(mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")])) %*% as.matrix(mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")])
)
solve(t(as.matrix(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")])) %*% as.matrix(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")])
)
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
regionNW + regionCN + regionCS + regionS + psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], method = "nearest", distance = "mahalanobis")
traceback()
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
regionNW + regionCN + regionCS + regionS + psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], method = "nearest", distance = "mahalanobis")
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
regionNW + regionCN + regionCS + regionS + psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], method = "nearest", distance = "logit")
cor(as.matrix(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")])))
cor(as.matrix(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")]))
test.matchit <-
matchit(treat1 ~  area + dcarr + avgelev + ejido +
psemidecid + pselva, data=mex.df[, c("treat1", "area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")], method = "nearest", distance = "logit")
solve(t(as.matrix(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")])) %*% as.matrix(mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionNW", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")])
)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 2,  distance.tolerance =  1e-12 )
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 1,  distance.tolerance =  1e-12 )
# Weight.matrix=diag(rep(1, 10)),
# rep(1, 10) runif(10)   , version="legacy"
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 1)
# Weight.matrix=diag(rep(1, 10)),
# rep(1, 10) runif(10)   , version="legacy"
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr", "avgelev", "ejido",
"regionCN", "regionCS", "regionS", "psemidecid", "pselva")], replace=FALSE, Weight= 2)
# Weight.matrix=diag(rep(1, 10)),
# rep(1, 10) runif(10)   , version="legacy"
summary(match.outcome.mah)
match.outcome.mah <- Match(Y=mex.df$pctpd0306, Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2)
summary(match.outcome.mah)
match.outcome.mah.results <- c(match.outcome.mah$est, match.outcome.mah$se.standard, match.outcome.mah$est/match.outcome.mah$se.standard,
(1-pnorm(abs(match.outcome.mah$est/match.outcome.mah$se.standard)))*2)
match.outcome.mah.results.df<- as.data.frame(t(match.outcome.mah.results))
colnames(match.outcome.mah.results.df) <- c("Estimate", "Std. Error", "t stat", "p-value")
stargazer(match.outcome.mah.results.df,
summary=FALSE, out.header = FALSE, out="/Users/travismcarthur/Desktop/Dev - AAE 642/Problem sets/PS 3/table10.tex", rownames=FALSE   )
str(match.outcome.mah$mdata)
str(match.outcome.mah$mdata$X)
match.outcome.mah$mdata$X
dim(mex.df)
match.outcome.mah$caliper
match.outcome.mah$ecaliper
data(lalonde)
#
# Estimate the propensity model
#
glm1  <- glm(treat~age + I(age^2) + educ + I(educ^2) + black +
hisp + married + nodegr + re74  + I(re74^2) + re75 + I(re75^2) +
u74 + u75, family=binomial, data=lalonde)
#
#save data objects
#
X  <- glm1$fitted
Y  <- lalonde$re78
Tr  <- lalonde$treat
#
# one-to-one matching with replacement (the "M=1" option).
# Estimating the treatment effect on the treated (the "estimand" option which defaults to 0).
#
rr  <- Match(Y=Y,Tr=Tr,X=X,M=1);
#Let's summarize the output
summary(rr)
# Let's check the covariate balance
# 'nboots' is set to small values in the interest of speed.
# Please increase to at least 500 each for publication quality p-values.
mb  <- MatchBalance(treat~age + I(age^2) + educ + I(educ^2) + black +
hisp + married + nodegr + re74  + I(re74^2) + re75 + I(re75^2) +
u74 + u75, data=lalonde, match.out=rr, nboots=10)
names(lalonde)
#
# Estimate the propensity model
#
glm1  <- glm(treat~age + I(age^2) + educ + I(educ^2) + black +
hispan + married + nodegr + re74  + I(re74^2) + re75 + I(re75^2) +
u74 + u75, family=binomial, data=lalonde)
#
#save data objects
#
X  <- glm1$fitted
Y  <- lalonde$re78
Tr  <- lalonde$treat
#
# one-to-one matching with replacement (the "M=1" option).
# Estimating the treatment effect on the treated (the "estimand" option which defaults to 0).
#
rr  <- Match(Y=Y,Tr=Tr,X=X,M=1);
#Let's summarize the output
summary(rr)
# Let's check the covariate balance
# 'nboots' is set to small values in the interest of speed.
# Please increase to at least 500 each for publication quality p-values.
mb  <- MatchBalance(treat~age + I(age^2) + educ + I(educ^2) + black +
hispan + married + nodegr + re74  + I(re74^2) + re75 + I(re75^2) +
u74 + u75, data=lalonde, match.out=rr, nboots=10)
glm1  <- glm(treat~age + I(age^2) + educ + I(educ^2) + black +
hispan + married + nodegree + re74  + I(re74^2) + re75 + I(re75^2) +
u74 + u75, family=binomial, data=lalonde)
library(matching)
library(Matching)
data(lalonde)
names(lalonde)
#
# Estimate the propensity model
#
glm1  <- glm(treat~age + I(age^2) + educ + I(educ^2) + black +
hispan + married + nodegree + re74  + I(re74^2) + re75 + I(re75^2) , family=binomial, data=lalonde)
#save data objects
#
X  <- glm1$fitted
Y  <- lalonde$re78
Tr  <- lalonde$treat
#
# one-to-one matching with replacement (the "M=1" option).
# Estimating the treatment effect on the treated (the "estimand" option which defaults to 0).
#
rr  <- Match(Y=Y,Tr=Tr,X=X,M=1);
#Let's summarize the output
summary(rr)
# Let's check the covariate balance
# 'nboots' is set to small values in the interest of speed.
# Please increase to at least 500 each for publication quality p-values.
mb  <- MatchBalance(treat~age + I(age^2) + educ + I(educ^2) + black +
hispan + married + nodegree + re74  + I(re74^2) + re75 + I(re75^2), data=lalonde, match.out=rr, nboots=10)
str(mb )
summary(mmatch.outcome.mah.limited)
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=.1)
summary(mmatch.outcome.mah.limited)
summary(match.outcome.mah.limited)
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=1)
summary(match.outcome.mah.limited)
mex.df$mah.matched.control <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.control, 1, 0)
mex.df$mah.matched.treat <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.treated, 1, 0)
t.stat.check.3 <- sapply(mex.df[, c("area", "pctpd0306", "dcarr", "avgelev", "avgslope", "ejido", "regionNW", "regionCN", "regionCS", "regionS", "region", "psemidecid", "pselva")],  FUN=function(x) {
ret <- t.test(x[mex.df$mah.matched.control==1], x[mex.df$mah.matched.treat==1])
if (all(x %in% 0:1)) {
ret.2 <- prop.test(x=c(sum(x[mex.df$mah.matched.control==1]), sum(x[mex.df$mah.matched.treat==1])),
n=rep(sum(mex.df$mah.matched.control), 2))
ret[] <- NA
} else {
ret.2 <- ks.test(x[mex.df$mah.matched.control==1], x[mex.df$mah.matched.treat==1])
}
if (all(x %in% 1:4)) {
ret.2 <- chisq.test( table(x[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ],
mex.df$mah.matched.control[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ])
)
}
c(mean(x[mex.df$mah.matched.control==1]), mean(x[mex.df$mah.matched.treat==1]), ret$statistic, ret$p.value, ret.2$statistic, ret.2$p.value)
}
)
t.stat.check.3
t.stat.check.3.df <- as.data.frame(t(t.stat.check.3 ))
t.stat.check.3.df[c("regionNW", "regionCN", "regionCS", "regionS"), 5:6] <- NA
t.stat.check.3.df["region", 1:4] <- NA
colnames(t.stat.check.3.df) <- c("Mean, control", "Mean, treatment", "t statistic", "p-val of t stat", "Distn. stat", "p-val of distn. stat")
t.stat.check.3.df
rep(sum(mex.df$mah.matched.control), 2)
sum(x[mex.df$mah.matched.control==1])
sum(mex.df$mah.matched.control )
sum(mex.df$mah.matched.treat)
table(mex.df$mah.matched.treat, mex.df$mah.matched.control)
table(mex.df$region[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ],
mex.df$mah.matched.control[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ])
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2)
mex.df$mah.matched.control <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.control, 1, 0)
mex.df$mah.matched.treat <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.treated, 1, 0)
table(mex.df$region[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ],
mex.df$mah.matched.control[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ])
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=.5)
summary(match.outcome.mah.limited)
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=1)
summary(match.outcome.mah.limited)
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=2)
summary(match.outcome.mah.limited)
table(mex.df$region[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ],
mex.df$mah.matched.control[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ])
mex.df$mah.matched.control <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.control, 1, 0)
mex.df$mah.matched.treat <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.treated, 1, 0)
table(mex.df$region[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ],
mex.df$mah.matched.control[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ])
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=3)
summary(match.outcome.mah.limited)
mex.df$mah.matched.control <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.control, 1, 0)
mex.df$mah.matched.treat <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.treated, 1, 0)
table(mex.df$region[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ],
mex.df$mah.matched.control[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ])
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=2.5)
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=2.5)
summary(match.outcome.mah.limited)
mex.df$mah.matched.control <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.control, 1, 0)
mex.df$mah.matched.treat <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.treated, 1, 0)
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=2)
summary(match.outcome.mah.limited)
mex.df$mah.matched.control <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.control, 1, 0)
mex.df$mah.matched.treat <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.treated, 1, 0)
match.outcome.mah.limited <- Match(Y=mex.df$pctpd0306,
Tr=mex.df$treat1, X=mex.df[, c("area", "dcarr",
"avgelev", "ejido", "regionCN", "regionCS", "regionS", "psemidecid", "pselva")],
replace=FALSE, Weight = 2, caliper=2.1)
summary(match.outcome.mah.limited)
mex.df$mah.matched.control <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.control, 1, 0)
mex.df$mah.matched.treat <- ifelse(1:nrow(mex.df) %in% match.outcome.mah.limited$index.treated, 1, 0)
table(mex.df$region[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ],
mex.df$mah.matched.control[mex.df$mah.matched.control==1 | mex.df$mah.matched.treat==1 ])
install.packages("optmatch")
library(optmatch)
matchon.test <- match_on(treat1 ~  area + dcarr + avgelev + ejido +
region.factor + psemidecid + pselva, data = mex.df)
traceback()
match_on(pr ~ t1 + t2, data = nuclearplants)
match_on(pr ~ t1 + t2, data = nuclearplants)
data(nuclearplants)
match_on(pr ~ t1 + t2, data = nuclearplants)
match_on(pr ~ t1 + t2, data = nuclearplants)
model.frame.default
match_on(pr ~ t1 + t2, data = nuclearplants)
traceback()
?attach
detach(Matching)
detach("Matching")
detach("package:Matching", character.only = TRUE)
match_on(pr ~ t1 + t2, data = nuclearplants)
detach("package:MatchIt", character.only = TRUE)
match_on(pr ~ t1 + t2, data = nuclearplants)
detach("package:stargazer", character.only = TRUE)
detach("package:stargazer", character.only = TRUE)
match_on(pr ~ t1 + t2, data = nuclearplants)
